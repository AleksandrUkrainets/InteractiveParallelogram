<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script type="text/javascript">
        var canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d');
        var width = "800", height = "600";

        var mouse = {
            x: 0,
            y: 0
        };

        var selected = false;
        var selectedLine1 = false;
        var selectedLine2 = false;
        var selectedLine3 = false;
        var selectedLine4 = false;
        let radiusCircle = 5.5;
        var circle = [];
        var line = [];
        var j = 0;
        var m = 0;

        canvas.width = width;
        canvas.height = height;
        canvas.style.backgroundColor = '#b7b6b6';

        ctx.fillStyle = 'red';
        ctx.lineWidth = 1;

        var Circle = function (x, y, r) {
            this.centerX = x;
            this.centerY = y;
            this.radius = r;
        };

        Circle.prototype = {
            draw: function () {
                ctx.beginPath();
                ctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.strokeStyle = 'red';
                ctx.stroke();
            },

            stroke: function () {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.strokeStyle = 'blue';
                ctx.stroke();
            },

            clear: function () {
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.arc(this.centerX, this.centerY, this.radius + ctx.lineWidth, 0, 2 * Math.PI, false);
                ctx.fillStyle = '#b7b6b6';
                ctx.fill();
                ctx.strokeStyle = '#b7b6b6';
                ctx.stroke();
            }
        };

        var Line = function (xStart, yStart, xEnd, yEnd) {
            this.xStart = xStart;
            this.yStart = yStart;
            this.xEnd = xEnd;
            this.yEnd = yEnd;
        };

        Line.prototype = {
            draw: function () {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = 'blue';
                ctx.moveTo(this.xStart, this.yStart);
                ctx.lineTo(this.xEnd, this.yEnd);
                ctx.stroke();
                ctx.closePath();
            },

            clear: function () {
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.moveTo(this.xStart, this.yStart);
                ctx.lineTo(this.xEnd, this.yEnd);
                ctx.strokeStyle = '#b7b6b6';
                ctx.stroke();
                ctx.closePath();
            }
        };

        var isCursorInCircle = function (circle) {
            return mouse.x > circle.centerX && mouse.x < circle.centerX + 2*circle.radius && mouse.y > circle.centerY  && mouse.y < circle.centerY + 2*circle.radius;
        };

        
        window.onmouseup = function () {
            if (j < 3) {
                circle.push(new Circle(mouse.x - radiusCircle, mouse.y - radiusCircle, radiusCircle));
                j++;
            }
            if (j == 3) {
                getParallelogram();
                j++;
            }

            selected = false;
        };

        var fourthPeakX = 0;
        var fourthPeakY = 0;

        var getParallelogram = function () {

            getFourthPeak();
            line.push(new Line(circle[0].centerX, circle[0].centerY, circle[1].centerX, circle[1].centerY));
            line.push(new Line(circle[1].centerX, circle[1].centerY, fourthPeakX, fourthPeakY));
            line.push(new Line(fourthPeakX, fourthPeakY, circle[2].centerX, circle[2].centerY));
            line.push(new Line(circle[2].centerX, circle[2].centerY, circle[0].centerX, circle[0].centerY));
            
        };

        var getFourthPeak = function () {

            fourthPeakX = (circle[2].centerX + circle[1].centerX) - circle[0].centerX;
            fourthPeakY = (circle[2].centerY + circle[1].centerY) - circle[0].centerY;
        }

        setInterval(function () {
            
            for (let i in circle) {
                circle[i].draw();

                if (isCursorInCircle(circle[i])) {
                    circle[i].stroke();
                }
            }

            for (let i in line) {
                line[i].draw();
            }

            if (selected) {
                selected.clear();
                selected.centerX = mouse.x - selected.radius;
                selected.centerY = mouse.y - selected.radius;
                selected.stroke();

                getFourthPeak();

                selectedLine1.clear();
                selectedLine2.clear();
                selectedLine3.clear();
                selectedLine4.clear();
                
                selectedLine1.xStart = mouse.x - selected.radius;
                selectedLine1.yStart = mouse.y - selected.radius;
                selectedLine4.xEnd = mouse.x - selected.radius;
                selectedLine4.yEnd = mouse.y - selected.radius;
                selectedLine3.xStart = fourthPeakX;
                selectedLine3.yStart = fourthPeakY;
                selectedLine2.xEnd = fourthPeakX;
                selectedLine2.yEnd = fourthPeakY;

                selectedLine1.draw();
                selectedLine2.draw();
                selectedLine3.draw();
                selectedLine4.draw();
            }

        }, 30);

        window.onmousemove = function (event) {
            mouse.x = event.pageX;
            mouse.y = event.pageY;
        };

        window.onmousedown = function () {
            if (!selected) {
                let  i;
                for (i in circle) {
                    if (isCursorInCircle(circle[i])) {
                        selected = circle[i];
                        if (i == 0) {
                            selectedLine1 = line[0];
                            selectedLine2 = line[1];
                            selectedLine3 = line[2];
                            selectedLine4 = line[3];
                        } 
                        if (i == 1) {
                            selectedLine1 = line[1];
                            selectedLine2 = line[1];
                            selectedLine3 = line[2];
                            selectedLine4 = line[0];
                        }
                        if (i == 2) {
                            selectedLine1 = line[3];
                            selectedLine2 = line[1];
                            selectedLine3 = line[2];
                            selectedLine4 = line[2];
                        }
                    }
                }
            }
        };

        

    </script>
</body>
</html>