<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script type="text/javascript">
        var canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d');
        var width = "800", height = "600";

        var mouse = {
            x: 0,
            y: 0
        };

        var selected = false;
        var selectedLine1 = false;
        var selectedLine2 = false;
        let radiusCircle = 5.5;
        var circle = [];
        var line = [];
        var j = 0;
        var m = 0;

        canvas.width = width;
        canvas.height = height;
        canvas.style.backgroundColor = '#b7b6b6';

        ctx.fillStyle = 'red';
        ctx.lineWidth = 1;

        var Circle = function (x, y, r) {
            this.centerX = x;
            this.centerY = y;
            this.radius = r;
        };

        Circle.prototype = {
            draw: function () {
                ctx.beginPath();
                ctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.strokeStyle = 'red';
                ctx.stroke();
            },

            stroke: function () {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.strokeStyle = 'blue';
                ctx.stroke();
            },

            clear: function () {
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.arc(this.centerX, this.centerY, this.radius + ctx.lineWidth, 0, 2 * Math.PI, false);
                ctx.fillStyle = '#b7b6b6';
                ctx.fill();
                ctx.strokeStyle = '#b7b6b6';
                ctx.stroke();
            }
        };

        var Line = function (xStart, yStart, xEnd, yEnd) {
            this.xStart = xStart;
            this.yStart = yStart;
            this.xEnd = xEnd;
            this.yEnd = yEnd;
        };

        Line.prototype = {
            draw: function () {
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = 'red';
                ctx.moveTo(this.xStart, this.yStart);
                ctx.lineTo(this.xEnd, this.yEnd);
                ctx.stroke();
                ctx.closePath();
            },

            clear: function () {
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.moveTo(this.xStart, this.yStart);
                ctx.lineTo(this.xEnd, this.yEnd);
                ctx.strokeStyle = '#b7b6b6';
                ctx.stroke();
                ctx.closePath();
            }
        };

        var isCursorInCircle = function (circle) {
            return mouse.x > circle.centerX && mouse.x < circle.centerX + 2*circle.radius && mouse.y > circle.centerY  && mouse.y < circle.centerY + 2*circle.radius;
        };

        
        window.onmouseup = function () {
            console.log('j1=', j);
            if (j < 3) {
                circle.push(new Circle(mouse.x - radiusCircle, mouse.y - radiusCircle, radiusCircle));
                j++;
                console.log('j2=', j);
            }

            console.log('j3=', j);
            if (j == 3) {
                for (m; m < 3; m++) {
                    if (m < 2) line.push(new Line(circle[m].centerX, circle[m].centerY, circle[m + 1].centerX, circle[m + 1].centerY));
                    if (m == 2) line.push(new Line(circle[m].centerX, circle[m].centerY, circle[0].centerX, circle[0].centerY));
                    console.log('m=', m, 'line[] =', line[m]);
                };
                
            }

            //for (let n in line) {
            //    line[n].clear();
            //    //line[m].draw();
            //    console.log('clear n=', n, 'xStart=', line[n].xStart, 'yStart=', line[n].yStart, 'xEnd=', line[n].xEnd, 'yEnd=', line[n].yEnd);
            //}
            //for (let n in line) {
            //    //line[m].clear();
            //    line[n].draw();
            //    console.log('draw n=', n, 'xStart=', line[n].xStart, 'yStart=', line[n].yStart, 'xEnd=', line[n].xEnd, 'yEnd=', line[n].yEnd);
            //}
            selected = false;
        };

        
        

        setInterval(function () {
            
            for (let i in circle) {
                circle[i].draw();

                if (isCursorInCircle(circle[i])) {
                    circle[i].stroke();
                }
            }

            for (let i in line) {
                //line[i].clear();
                line[i].draw();
            }

            if (selected) {
                selected.clear();
                selected.centerX = mouse.x - selected.radius;
                selected.centerY = mouse.y - selected.radius;
                selected.stroke();


                selectedLine1.clear();
                selectedLine2.clear();
                
                selectedLine1.xStart = mouse.x - selected.radius;
                console.log('selectedLine1.xStart =', selectedLine1.xStart);
                selectedLine1.yStart = mouse.y - selected.radius;
                console.log('selectedLine1.yStart=', selectedLine1.yStart);

                selectedLine2.xEnd = mouse.x - selected.radius;
                selectedLine2.yEnd = mouse.y - selected.radius;

                selectedLine1.draw();
                selectedLine2.draw();
            }

        }, 30);

        window.onmousemove = function (event) {
            mouse.x = event.pageX;
            mouse.y = event.pageY;
        };

        window.onmousedown = function () {
            if (!selected) {
                let  i;
                for (i in circle) {
                    if (isCursorInCircle(circle[i])) {
                        selected = circle[i];
                        if (i == 0) {
                            selectedLine1 = line[0];
                            selectedLine2 = line[2];
                        } 
                        if (i == 1) {
                            selectedLine1 = line[1];
                            selectedLine2 = line[0];
                        }
                        if (i == 2) {
                            selectedLine1 = line[2];
                            selectedLine2 = line[1];
                        }

                    }
                }
            }
            console.log('x=', mouse.x, 'y=', mouse.y);
        };

        

    </script>
</body>
</html>